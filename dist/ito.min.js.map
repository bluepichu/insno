{"version":3,"sources":["ito.js"],"names":["__extends","d","b","__","this","constructor","p","hasOwnProperty","prototype","Object","create","RecongizerResponse","ACCEPT","REJECT","WAIT","GestureGraph","element","_element","_nodes","_clearNode","GestureNode","_startNode","then","event","type","touches","length","_currentNode","undefined","_listeners","state","handleTouch","preventDefault","start","node","getNode","Error","setNodeName","name","moveToNode","enter","reset","fire","events","_this","forEach","_a","arg","listener","addEventListener","push","listen","handler","bind","wait","parent","_parent","_name","_events","_recognizers","_timeout","_currentRecognizers","_currentTimeout","_goto","evt","matcher","next","match","timeout","time","map","res","Array","isArray","slice","setTimeout","advanceTo","clearTimeout","i","splice","Ito","_super","apply","arguments"],"mappings":"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","file":"ito.js","sourcesContent":["\"use strict\";\n\nvar __extends = undefined && undefined.__extends || function (d, b) {\n    for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n    }function __() {\n        this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar RecongizerResponse;\n(function (RecongizerResponse) {\n    RecongizerResponse[RecongizerResponse[\"ACCEPT\"] = 0] = \"ACCEPT\";\n    RecongizerResponse[RecongizerResponse[\"REJECT\"] = 1] = \"REJECT\";\n    RecongizerResponse[RecongizerResponse[\"WAIT\"] = 2] = \"WAIT\";\n})(RecongizerResponse || (RecongizerResponse = {}));\nvar ACCEPT = RecongizerResponse.ACCEPT;\nvar REJECT = RecongizerResponse.REJECT;\nvar WAIT = RecongizerResponse.WAIT;\nvar GestureGraph = function () {\n    function GestureGraph(element) {\n        this._element = element;\n        this._nodes = {};\n        this._clearNode = new GestureNode(this);\n        this._startNode = this._clearNode.then(function (event) {\n            return event.type === \"touchend\" && event.touches.length === 0 ? ACCEPT : WAIT;\n        });\n        this._currentNode = undefined;\n        this._listeners = {};\n        this.state = {};\n    }\n    GestureGraph.prototype.handleTouch = function (event) {\n        this._currentNode.handleTouch(event);\n        event.preventDefault();\n    };\n    GestureGraph.prototype.start = function (node) {\n        var start = undefined;\n        if (node !== undefined) {\n            start = this.getNode(node);\n        } else {\n            start = this._startNode;\n        }\n        if (start === undefined) {\n            throw new Error(\"Ito Error: illegal state\");\n        }\n        return start;\n    };\n    GestureGraph.prototype.setNodeName = function (node, name) {\n        if (name in this._nodes) {\n            throw new Error(\"Ito Error: GestureNode with name \\\"\" + name + \"\\\" already exists\");\n        }\n        this._nodes[name] = node;\n    };\n    GestureGraph.prototype.moveToNode = function (node) {\n        this._currentNode = this.getNode(node);\n        this._currentNode.enter();\n    };\n    GestureGraph.prototype.getNode = function (node) {\n        if (typeof node === \"string\") {\n            if (node in this._nodes) {\n                return this._nodes[node];\n            } else {\n                throw new Error(\"Ito Error: node with name \\\"\" + node + \"\\\" not found\");\n            }\n        } else {\n            return node;\n        }\n    };\n    GestureGraph.prototype.reset = function () {\n        this.moveToNode(this._startNode);\n    };\n    GestureGraph.prototype.fire = function (events) {\n        var _this = this;\n        events.forEach(function (_a) {\n            var event = _a[0],\n                arg = _a[1];\n            if (event in _this._listeners) {\n                _this._listeners[event].forEach(function (listener) {\n                    listener(arg);\n                });\n            }\n        });\n    };\n    GestureGraph.prototype.addEventListener = function (event, listener) {\n        if (!(event in this._listeners)) {\n            this._listeners[event] = [];\n        }\n        this._listeners[event].push(listener);\n    };\n    GestureGraph.prototype.listen = function () {\n        if (this._currentNode !== undefined) {\n            throw new Error(\"Ito Error: this instance is already listening\");\n        }\n        var handler = this.handleTouch.bind(this);\n        this._element.addEventListener(\"touchstart\", handler);\n        this._element.addEventListener(\"touchend\", handler);\n        this._element.addEventListener(\"touchmove\", handler);\n        this.reset();\n    };\n    GestureGraph.prototype.wait = function () {\n        this.moveToNode(this._clearNode);\n    };\n    return GestureGraph;\n}();\nvar GestureNode = function () {\n    function GestureNode(parent) {\n        this._parent = parent;\n        this._name = undefined;\n        this._events = [];\n        this._recognizers = [];\n        this._timeout = undefined;\n        this._currentRecognizers = undefined;\n        this._currentTimeout = undefined;\n        this._goto = undefined;\n    }\n    GestureNode.prototype.name = function (name) {\n        if (this._name !== undefined) {\n            throw new Error(\"Ito Error: GestureNode \\\"\" + this._name + \"\\\" is already named and cannot be renamed\");\n        }\n        this._parent.setNodeName(this, name);\n        this._name = name;\n        return this;\n    };\n    GestureNode.prototype.fire = function (evt) {\n        this._events.push(evt);\n        return this;\n    };\n    GestureNode.prototype.then = function (matcher) {\n        var next = new GestureNode(this._parent);\n        this._recognizers.push({\n            match: matcher,\n            next: next\n        });\n        return next;\n    };\n    GestureNode.prototype.timeout = function (time) {\n        var next = new GestureNode(this._parent);\n        this._timeout = {\n            time: time,\n            next: next\n        };\n        return next;\n    };\n    GestureNode.prototype.enter = function () {\n        var _this = this;\n        var events = this._events.map(function (event) {\n            if (typeof event === \"string\") {\n                return [event, undefined];\n            } else {\n                var res = event(_this._parent.state);\n                if (Array.isArray(res)) {\n                    return res;\n                } else {\n                    return [res, undefined];\n                }\n            }\n        });\n        this._parent.fire(events);\n        if (this._goto !== undefined) {\n            this._parent.moveToNode(this._goto);\n            return;\n        }\n        this._currentRecognizers = this._recognizers.slice();\n        if (this._timeout !== undefined) {\n            this._currentTimeout = setTimeout(function () {\n                return _this.advanceTo(_this._timeout.next);\n            }, this._timeout.time);\n        }\n        if (this._currentRecognizers.length === 0 && this._timeout === undefined) {\n            this.wait();\n        }\n    };\n    GestureNode.prototype.handleTouch = function (event) {\n        clearTimeout(this._currentTimeout);\n        for (var i = 0; i < this._currentRecognizers.length; i++) {\n            switch (this._currentRecognizers[i].match(event, this._parent.state)) {\n                case ACCEPT:\n                    this.advanceTo(this._currentRecognizers[i].next);\n                    return;\n                case REJECT:\n                    this._currentRecognizers.splice(i, 1);\n                    i--;\n                    break;\n                case WAIT:\n                    break;\n                default:\n                    throw new Error(\"Ito Error: invalid return from matcher (not ACCEPT, REJECT, or WAIT)\");\n            }\n        }\n        if (this._currentRecognizers.length === 0) {\n            this.wait();\n        }\n    };\n    GestureNode.prototype.wait = function () {\n        clearTimeout(this._currentTimeout);\n        this._parent.wait();\n    };\n    GestureNode.prototype.advanceTo = function (node) {\n        clearTimeout(this._currentTimeout);\n        this._currentRecognizers = undefined;\n        this._currentTimeout = undefined;\n        this._parent.moveToNode(node);\n    };\n    GestureNode.prototype.goto = function (node) {\n        this._goto = node;\n    };\n    return GestureNode;\n}();\nvar Ito = function (_super) {\n    __extends(Ito, _super);\n    function Ito() {\n        _super.apply(this, arguments);\n    }\n    Ito.ACCEPT = ACCEPT;\n    Ito.REJECT = REJECT;\n    Ito.WAIT = WAIT;\n    return Ito;\n}(GestureGraph);\n//# sourceMappingURL=ito.js.map\n"],"sourceRoot":"/source/"}