{"version":3,"sources":["ito.js"],"names":["__extends","d","b","__","this","constructor","p","hasOwnProperty","prototype","Object","create","RecongizerResponse","ACCEPT","REJECT","WAIT","GestureGraph","element","_element","_nodes","_clearNode","GestureNode","_startNode","then","event","type","touches","length","_currentNode","undefined","_listeners","state","handleTouch","preventDefault","start","node","getNode","Error","setNodeName","name","moveToNode","enter","reset","fire","events","_this","forEach","listener","addEventListener","push","listen","handler","bind","wait","parent","_parent","_name","_events","_recognizers","_timeout","_currentRecognizers","_currentTimeout","_goto","evt","matcher","next","match","timeout","time","evts","concat","trim","split","filter","ev","slice","setTimeout","advanceTo","clearTimeout","i","splice","Ito","_super","apply","arguments"],"mappings":"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","file":"ito.js","sourcesContent":["\"use strict\";\n\nvar __extends = undefined && undefined.__extends || function (d, b) {\n    for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n    }function __() {\n        this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar RecongizerResponse;\n(function (RecongizerResponse) {\n    RecongizerResponse[RecongizerResponse[\"ACCEPT\"] = 0] = \"ACCEPT\";\n    RecongizerResponse[RecongizerResponse[\"REJECT\"] = 1] = \"REJECT\";\n    RecongizerResponse[RecongizerResponse[\"WAIT\"] = 2] = \"WAIT\";\n})(RecongizerResponse || (RecongizerResponse = {}));\nvar ACCEPT = RecongizerResponse.ACCEPT;\nvar REJECT = RecongizerResponse.REJECT;\nvar WAIT = RecongizerResponse.WAIT;\nvar GestureGraph = function () {\n    function GestureGraph(element) {\n        this._element = element;\n        this._nodes = {};\n        this._clearNode = new GestureNode(this);\n        this._startNode = this._clearNode.then(function (event) {\n            return event.type === \"touchend\" && event.touches.length === 0 ? ACCEPT : WAIT;\n        });\n        this._currentNode = undefined;\n        this._listeners = {};\n        this.state = {};\n    }\n    GestureGraph.prototype.handleTouch = function (event) {\n        this._currentNode.handleTouch(event);\n        event.preventDefault();\n    };\n    GestureGraph.prototype.start = function (node) {\n        var start = undefined;\n        if (node !== undefined) {\n            start = this.getNode(node);\n        } else {\n            start = this._startNode;\n        }\n        if (start === undefined) {\n            throw new Error(\"Ito Error: illegal state\");\n        }\n        return start;\n    };\n    GestureGraph.prototype.setNodeName = function (node, name) {\n        if (name in this._nodes) {\n            throw new Error(\"Ito Error: GestureNode with name \\\"\" + name + \"\\\" already exists\");\n        }\n        this._nodes[name] = node;\n    };\n    GestureGraph.prototype.moveToNode = function (node) {\n        this._currentNode = this.getNode(node);\n        this._currentNode.enter();\n    };\n    GestureGraph.prototype.getNode = function (node) {\n        if (typeof node === \"string\") {\n            if (node in this._nodes) {\n                return this._nodes[node];\n            } else {\n                throw new Error(\"Ito Error: node with name \\\"\" + node + \"\\\" not found\");\n            }\n        } else {\n            return node;\n        }\n    };\n    GestureGraph.prototype.reset = function () {\n        this.moveToNode(this._startNode);\n    };\n    GestureGraph.prototype.fire = function (events) {\n        var _this = this;\n        events.forEach(function (event) {\n            if (event in _this._listeners) {\n                _this._listeners[event].forEach(function (listener) {\n                    listener();\n                });\n            }\n        });\n    };\n    GestureGraph.prototype.addEventListener = function (event, listener) {\n        if (!(event in this._listeners)) {\n            this._listeners[event] = [];\n        }\n        this._listeners[event].push(listener);\n    };\n    GestureGraph.prototype.listen = function () {\n        if (this._currentNode !== undefined) {\n            throw new Error(\"Ito Error: this instance is already listening\");\n        }\n        var handler = this.handleTouch.bind(this);\n        this._element.addEventListener(\"touchstart\", handler);\n        this._element.addEventListener(\"touchend\", handler);\n        this._element.addEventListener(\"touchmove\", handler);\n        this.reset();\n    };\n    GestureGraph.prototype.wait = function () {\n        this.moveToNode(this._clearNode);\n    };\n    return GestureGraph;\n}();\nvar GestureNode = function () {\n    function GestureNode(parent) {\n        this._parent = parent;\n        this._name = undefined;\n        this._events = [];\n        this._recognizers = [];\n        this._timeout = undefined;\n        this._currentRecognizers = undefined;\n        this._currentTimeout = undefined;\n        this._goto = undefined;\n    }\n    GestureNode.prototype.name = function (name) {\n        if (this._name !== undefined) {\n            throw new Error(\"Ito Error: GestureNode \\\"\" + this._name + \"\\\" is already named and cannot be renamed\");\n        }\n        this._parent.setNodeName(this, name);\n        this._name = name;\n        return this;\n    };\n    GestureNode.prototype.fire = function (evt) {\n        this._events.push(evt);\n        return this;\n    };\n    GestureNode.prototype.then = function (matcher) {\n        var next = new GestureNode(this._parent);\n        this._recognizers.push({\n            match: matcher,\n            next: next\n        });\n        return next;\n    };\n    GestureNode.prototype.timeout = function (time) {\n        var next = new GestureNode(this._parent);\n        this._timeout = {\n            time: time,\n            next: next\n        };\n        return next;\n    };\n    GestureNode.prototype.enter = function () {\n        var _this = this;\n        var events = [];\n        this._events.forEach(function (event) {\n            var evts;\n            if (typeof event === \"string\") {\n                evts = event;\n            } else {\n                evts = event(_this._parent.state);\n            }\n            events = events.concat(evts.trim().split(/\\s+/g).filter(function (ev) {\n                return ev !== \"\";\n            }));\n        });\n        this._parent.fire(events);\n        if (this._goto !== undefined) {\n            this._parent.moveToNode(this._goto);\n            return;\n        }\n        this._currentRecognizers = this._recognizers.slice();\n        if (this._timeout !== undefined) {\n            this._currentTimeout = setTimeout(function () {\n                return _this.advanceTo(_this._timeout.next);\n            }, this._timeout.time);\n        }\n        if (this._currentRecognizers.length === 0 && this._timeout === undefined) {\n            this.wait();\n        }\n    };\n    GestureNode.prototype.handleTouch = function (event) {\n        clearTimeout(this._currentTimeout);\n        for (var i = 0; i < this._currentRecognizers.length; i++) {\n            switch (this._currentRecognizers[i].match(event, this._parent.state)) {\n                case ACCEPT:\n                    this.advanceTo(this._currentRecognizers[i].next);\n                    return;\n                case REJECT:\n                    this._currentRecognizers.splice(i, 1);\n                    i--;\n                    break;\n                case WAIT:\n                    break;\n                default:\n                    throw new Error(\"Ito Error: invalid return from matcher (not ACCEPT, REJECT, or WAIT)\");\n            }\n        }\n        if (this._currentRecognizers.length === 0) {\n            this.wait();\n        }\n    };\n    GestureNode.prototype.wait = function () {\n        clearTimeout(this._currentTimeout);\n        this._parent.wait();\n    };\n    GestureNode.prototype.advanceTo = function (node) {\n        clearTimeout(this._currentTimeout);\n        this._currentRecognizers = undefined;\n        this._currentTimeout = undefined;\n        this._parent.moveToNode(node);\n    };\n    GestureNode.prototype.goto = function (node) {\n        this._goto = node;\n    };\n    return GestureNode;\n}();\nvar Ito = function (_super) {\n    __extends(Ito, _super);\n    function Ito() {\n        _super.apply(this, arguments);\n    }\n    Ito.ACCEPT = ACCEPT;\n    Ito.REJECT = REJECT;\n    Ito.WAIT = WAIT;\n    return Ito;\n}(GestureGraph);\n//# sourceMappingURL=ito.js.map\n"],"sourceRoot":"/source/"}