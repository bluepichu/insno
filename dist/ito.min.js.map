{"version":3,"sources":["ito.js"],"names":["RecongizerResponse","ACCEPT","REJECT","WAIT","GestureGraph","element","this","_element","_nodes","_clearNode","GestureNode","_startNode","then","event","type","touches","length","_currentNode","undefined","_listeners","state","prototype","handleTouch","preventDefault","start","node","getNode","Error","setNodeName","name","moveToNode","enter","reset","fire","events","_this","forEach","listener","addEventListener","push","listen","handler","bind","wait","parent","_parent","_name","_events","_recognizers","_timeout","_currentRecognizers","_currentTimeout","_goto","evt","matcher","next","match","timeout","time","evts","concat","trim","split","filter","ev","slice","setTimeout","advanceTo","clearTimeout","i","splice","Ito"],"mappings":"AAAA,YAEA,IAAIA,qBACJ,SAAWA,GACPA,EAAmBA,EAA2B,OAAI,GAAK,SACvDA,EAAmBA,EAA2B,OAAI,GAAK,SACvDA,EAAmBA,EAAyB,KAAI,GAAK,QACtDA,qBAAuBA,uBAC1B,IAAIC,QAASD,mBAAmBC,OAC5BC,OAASF,mBAAmBE,OAC5BC,KAAOH,mBAAmBG,KAC1BC,aAAe,WACf,QAASA,GAAaC,GAClBC,KAAKC,SAAWF,EAChBC,KAAKE,UACLF,KAAKG,WAAa,GAAIC,aAAYJ,MAClCA,KAAKK,WAAaL,KAAKG,WAAWG,KAAK,SAAUC,GAC7C,MAAsB,aAAfA,EAAMC,MAAgD,IAAzBD,EAAME,QAAQC,OAAef,OAASE,OAE9EG,KAAKW,aAAeC,OACpBZ,KAAKa,cACLb,KAAKc,SAuET,MArEAhB,GAAaiB,UAAUC,YAAc,SAAUT,GAC3CP,KAAKW,aAAaK,YAAYT,GAC9BA,EAAMU,kBAEVnB,EAAaiB,UAAUG,MAAQ,SAAUC,GACrC,GAAID,GAAQN,MAMZ,IAJIM,EADSN,SAATO,EACQnB,KAAKoB,QAAQD,GAEbnB,KAAKK,WAEHO,SAAVM,EACA,KAAM,IAAIG,OAAM,2BAEpB,OAAOH,IAEXpB,EAAaiB,UAAUO,YAAc,SAAUH,EAAMI,GACjD,GAAIA,IAAQvB,MAAKE,OACb,KAAM,IAAImB,OAAM,qCAAwCE,EAAO,mBAEnEvB,MAAKE,OAAOqB,GAAQJ,GAExBrB,EAAaiB,UAAUS,WAAa,SAAUL,GAC1CnB,KAAKW,aAAeX,KAAKoB,QAAQD,GACjCnB,KAAKW,aAAac,SAEtB3B,EAAaiB,UAAUK,QAAU,SAAUD,GACvC,GAAoB,gBAATA,GAAmB,CAC1B,GAAIA,IAAQnB,MAAKE,OACb,MAAOF,MAAKE,OAAOiB,EAEnB,MAAM,IAAIE,OAAM,8BAAiCF,EAAO,eAG5D,MAAOA,IAGfrB,EAAaiB,UAAUW,MAAQ,WAC3B1B,KAAKwB,WAAWxB,KAAKK,aAEzBP,EAAaiB,UAAUY,KAAO,SAAUC,GACpC,GAAIC,GAAQ7B,IACZ4B,GAAOE,QAAQ,SAAUvB,GACjBA,IAASsB,GAAMhB,YACfgB,EAAMhB,WAAWN,GAAOuB,QAAQ,SAAUC,GACtCA,SAKhBjC,EAAaiB,UAAUiB,iBAAmB,SAAUzB,EAAOwB,GACjDxB,IAASP,MAAKa,aAChBb,KAAKa,WAAWN,OAEpBP,KAAKa,WAAWN,GAAO0B,KAAKF,IAEhCjC,EAAaiB,UAAUmB,OAAS,WAC5B,GAA0BtB,SAAtBZ,KAAKW,aACL,KAAM,IAAIU,OAAM,gDAEpB,IAAIc,GAAUnC,KAAKgB,YAAYoB,KAAKpC,KACpCA,MAAKC,SAAS+B,iBAAiB,aAAcG,GAC7CnC,KAAKC,SAAS+B,iBAAiB,WAAYG,GAC3CnC,KAAKC,SAAS+B,iBAAiB,YAAaG,GAC5CnC,KAAK0B,SAET5B,EAAaiB,UAAUsB,KAAO,WAC1BrC,KAAKwB,WAAWxB,KAAKG,aAElBL,KAEPM,YAAc,WACd,QAASA,GAAYkC,GACjBtC,KAAKuC,QAAUD,EACftC,KAAKwC,MAAQ5B,OACbZ,KAAKyC,WACLzC,KAAK0C,gBACL1C,KAAK2C,SAAW/B,OAChBZ,KAAK4C,oBAAsBhC,OAC3BZ,KAAK6C,gBAAkBjC,OACvBZ,KAAK8C,MAAQlC,OA6FjB,MA3FAR,GAAYW,UAAUQ,KAAO,SAAUA,GACnC,GAAmBX,SAAfZ,KAAKwC,MACL,KAAM,IAAInB,OAAM,2BAA8BrB,KAAKwC,MAAQ,2CAI/D,OAFAxC,MAAKuC,QAAQjB,YAAYtB,KAAMuB,GAC/BvB,KAAKwC,MAAQjB,EACNvB,MAEXI,EAAYW,UAAUY,KAAO,SAAUoB,GAEnC,MADA/C,MAAKyC,QAAQR,KAAKc,GACX/C,MAEXI,EAAYW,UAAUT,KAAO,SAAU0C,GACnC,GAAIC,GAAO,GAAI7C,GAAYJ,KAAKuC,QAKhC,OAJAvC,MAAK0C,aAAaT,MACdiB,MAAOF,EACPC,KAAMA,IAEHA,GAEX7C,EAAYW,UAAUoC,QAAU,SAAUC,GACtC,GAAIH,GAAO,GAAI7C,GAAYJ,KAAKuC,QAKhC,OAJAvC,MAAK2C,UACDS,KAAMA,EACNH,KAAMA,GAEHA,GAEX7C,EAAYW,UAAUU,MAAQ,WAC1B,GAAII,GAAQ7B,KACR4B,IAaJ,OAZA5B,MAAKyC,QAAQX,QAAQ,SAAUvB,GAC3B,GAAI8C,EAEAA,GADiB,gBAAV9C,GACAA,EAEAA,EAAMsB,EAAMU,QAAQzB,OAE/Bc,EAASA,EAAO0B,OAAOD,EAAKE,OAAOC,MAAM,QAAQC,OAAO,SAAUC,GAC9D,MAAc,KAAPA,OAGf1D,KAAKuC,QAAQZ,KAAKC,GACChB,SAAfZ,KAAK8C,UACL9C,MAAKuC,QAAQf,WAAWxB,KAAK8C,QAGjC9C,KAAK4C,oBAAsB5C,KAAK0C,aAAaiB,QACvB/C,SAAlBZ,KAAK2C,WACL3C,KAAK6C,gBAAkBe,WAAW,WAC9B,MAAO/B,GAAMgC,UAAUhC,EAAMc,SAASM,OACvCjD,KAAK2C,SAASS,YAEmB,IAApCpD,KAAK4C,oBAAoBlC,QAAkCE,SAAlBZ,KAAK2C,UAC9C3C,KAAKqC,UAGbjC,EAAYW,UAAUC,YAAc,SAAUT,GAC1CuD,aAAa9D,KAAK6C,gBAClB,KAAK,GAAIkB,GAAI,EAAGA,EAAI/D,KAAK4C,oBAAoBlC,OAAQqD,IACjD,OAAQ/D,KAAK4C,oBAAoBmB,GAAGb,MAAM3C,EAAOP,KAAKuC,QAAQzB,QAC1D,IAAKnB,QAED,WADAK,MAAK6D,UAAU7D,KAAK4C,oBAAoBmB,GAAGd,KAE/C,KAAKrD,QACDI,KAAK4C,oBAAoBoB,OAAOD,EAAG,GACnCA,GACA,MACJ,KAAKlE,MACD,KACJ,SACI,KAAM,IAAIwB,OAAM,wEAGY,IAApCrB,KAAK4C,oBAAoBlC,QACzBV,KAAKqC,QAGbjC,EAAYW,UAAUsB,KAAO,WACzByB,aAAa9D,KAAK6C,iBAClB7C,KAAKuC,QAAQF,QAEjBjC,EAAYW,UAAU8C,UAAY,SAAU1C,GACxC2C,aAAa9D,KAAK6C,iBAClB7C,KAAK4C,oBAAsBhC,OAC3BZ,KAAK6C,gBAAkBjC,OACvBZ,KAAKuC,QAAQf,WAAWL,IAE5Bf,EAAYW,UAAZX,QAA6B,SAAUe,GACnCnB,KAAK8C,MAAQ3B,GAEVf,MAEXQ,QAAUqD,IAAMnE,cAChBc,QAAUqD,IAAItE,OAASA,QACvBiB,QAAUqD,IAAIrE,OAASA,QACvBgB,QAAUqD,IAAIpE,KAAOA","file":"ito.js","sourcesContent":["\"use strict\";\n\nvar RecongizerResponse;\n(function (RecongizerResponse) {\n    RecongizerResponse[RecongizerResponse[\"ACCEPT\"] = 0] = \"ACCEPT\";\n    RecongizerResponse[RecongizerResponse[\"REJECT\"] = 1] = \"REJECT\";\n    RecongizerResponse[RecongizerResponse[\"WAIT\"] = 2] = \"WAIT\";\n})(RecongizerResponse || (RecongizerResponse = {}));\nvar ACCEPT = RecongizerResponse.ACCEPT;\nvar REJECT = RecongizerResponse.REJECT;\nvar WAIT = RecongizerResponse.WAIT;\nvar GestureGraph = function () {\n    function GestureGraph(element) {\n        this._element = element;\n        this._nodes = {};\n        this._clearNode = new GestureNode(this);\n        this._startNode = this._clearNode.then(function (event) {\n            return event.type === \"touchend\" && event.touches.length === 0 ? ACCEPT : WAIT;\n        });\n        this._currentNode = undefined;\n        this._listeners = {};\n        this.state = {};\n    }\n    GestureGraph.prototype.handleTouch = function (event) {\n        this._currentNode.handleTouch(event);\n        event.preventDefault();\n    };\n    GestureGraph.prototype.start = function (node) {\n        var start = undefined;\n        if (node !== undefined) {\n            start = this.getNode(node);\n        } else {\n            start = this._startNode;\n        }\n        if (start === undefined) {\n            throw new Error(\"Ito Error: illegal state\");\n        }\n        return start;\n    };\n    GestureGraph.prototype.setNodeName = function (node, name) {\n        if (name in this._nodes) {\n            throw new Error(\"Ito Error: GestureNode with name \\\"\" + name + \"\\\" already exists\");\n        }\n        this._nodes[name] = node;\n    };\n    GestureGraph.prototype.moveToNode = function (node) {\n        this._currentNode = this.getNode(node);\n        this._currentNode.enter();\n    };\n    GestureGraph.prototype.getNode = function (node) {\n        if (typeof node === \"string\") {\n            if (node in this._nodes) {\n                return this._nodes[node];\n            } else {\n                throw new Error(\"Ito Error: node with name \\\"\" + node + \"\\\" not found\");\n            }\n        } else {\n            return node;\n        }\n    };\n    GestureGraph.prototype.reset = function () {\n        this.moveToNode(this._startNode);\n    };\n    GestureGraph.prototype.fire = function (events) {\n        var _this = this;\n        events.forEach(function (event) {\n            if (event in _this._listeners) {\n                _this._listeners[event].forEach(function (listener) {\n                    listener();\n                });\n            }\n        });\n    };\n    GestureGraph.prototype.addEventListener = function (event, listener) {\n        if (!(event in this._listeners)) {\n            this._listeners[event] = [];\n        }\n        this._listeners[event].push(listener);\n    };\n    GestureGraph.prototype.listen = function () {\n        if (this._currentNode !== undefined) {\n            throw new Error(\"Ito Error: this instance is already listening\");\n        }\n        var handler = this.handleTouch.bind(this);\n        this._element.addEventListener(\"touchstart\", handler);\n        this._element.addEventListener(\"touchend\", handler);\n        this._element.addEventListener(\"touchmove\", handler);\n        this.reset();\n    };\n    GestureGraph.prototype.wait = function () {\n        this.moveToNode(this._clearNode);\n    };\n    return GestureGraph;\n}();\nvar GestureNode = function () {\n    function GestureNode(parent) {\n        this._parent = parent;\n        this._name = undefined;\n        this._events = [];\n        this._recognizers = [];\n        this._timeout = undefined;\n        this._currentRecognizers = undefined;\n        this._currentTimeout = undefined;\n        this._goto = undefined;\n    }\n    GestureNode.prototype.name = function (name) {\n        if (this._name !== undefined) {\n            throw new Error(\"Ito Error: GestureNode \\\"\" + this._name + \"\\\" is already named and cannot be renamed\");\n        }\n        this._parent.setNodeName(this, name);\n        this._name = name;\n        return this;\n    };\n    GestureNode.prototype.fire = function (evt) {\n        this._events.push(evt);\n        return this;\n    };\n    GestureNode.prototype.then = function (matcher) {\n        var next = new GestureNode(this._parent);\n        this._recognizers.push({\n            match: matcher,\n            next: next\n        });\n        return next;\n    };\n    GestureNode.prototype.timeout = function (time) {\n        var next = new GestureNode(this._parent);\n        this._timeout = {\n            time: time,\n            next: next\n        };\n        return next;\n    };\n    GestureNode.prototype.enter = function () {\n        var _this = this;\n        var events = [];\n        this._events.forEach(function (event) {\n            var evts;\n            if (typeof event === \"string\") {\n                evts = event;\n            } else {\n                evts = event(_this._parent.state);\n            }\n            events = events.concat(evts.trim().split(/\\s+/g).filter(function (ev) {\n                return ev !== \"\";\n            }));\n        });\n        this._parent.fire(events);\n        if (this._goto !== undefined) {\n            this._parent.moveToNode(this._goto);\n            return;\n        }\n        this._currentRecognizers = this._recognizers.slice();\n        if (this._timeout !== undefined) {\n            this._currentTimeout = setTimeout(function () {\n                return _this.advanceTo(_this._timeout.next);\n            }, this._timeout.time);\n        }\n        if (this._currentRecognizers.length === 0 && this._timeout === undefined) {\n            this.wait();\n        }\n    };\n    GestureNode.prototype.handleTouch = function (event) {\n        clearTimeout(this._currentTimeout);\n        for (var i = 0; i < this._currentRecognizers.length; i++) {\n            switch (this._currentRecognizers[i].match(event, this._parent.state)) {\n                case ACCEPT:\n                    this.advanceTo(this._currentRecognizers[i].next);\n                    return;\n                case REJECT:\n                    this._currentRecognizers.splice(i, 1);\n                    i--;\n                    break;\n                case WAIT:\n                    break;\n                default:\n                    throw new Error(\"Ito Error: invalid return from matcher (not ACCEPT, REJECT, or WAIT)\");\n            }\n        }\n        if (this._currentRecognizers.length === 0) {\n            this.wait();\n        }\n    };\n    GestureNode.prototype.wait = function () {\n        clearTimeout(this._currentTimeout);\n        this._parent.wait();\n    };\n    GestureNode.prototype.advanceTo = function (node) {\n        clearTimeout(this._currentTimeout);\n        this._currentRecognizers = undefined;\n        this._currentTimeout = undefined;\n        this._parent.moveToNode(node);\n    };\n    GestureNode.prototype.goto = function (node) {\n        this._goto = node;\n    };\n    return GestureNode;\n}();\nundefined.Ito = GestureGraph;\nundefined.Ito.ACCEPT = ACCEPT;\nundefined.Ito.REJECT = REJECT;\nundefined.Ito.WAIT = WAIT;\n//# sourceMappingURL=ito.js.map\n"],"sourceRoot":"/source/"}